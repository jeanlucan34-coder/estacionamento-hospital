<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Sincroniza√ß√£o</title>
    <style>
        body {
            font-family: monospace;
            padding: 40px;
            background: #f5f5f5;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .box {
            background: white;
            padding: 30px;
            margin: 20px 0;
            border-radius: 10px;
            border: 3px solid #333;
        }
        
        .success {
            border-color: #28a745;
            background: #d4edda;
        }
        
        .error {
            border-color: #dc3545;
            background: #f8d7da;
        }
        
        .warning {
            border-color: #ffc107;
            background: #fff3cd;
        }
        
        h1 {
            color: #333;
            border-bottom: 3px solid #333;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #666;
            margin-top: 20px;
        }
        
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #dee2e6;
        }
        
        button {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            margin: 10px 5px;
            color: white;
        }
        
        .btn-test {
            background: #007bff;
        }
        
        .btn-clear {
            background: #dc3545;
        }
        
        .btn-reload {
            background: #28a745;
        }
    </style>
</head>
<body>
    <h1>üîç DIAGN√ìSTICO DE SINCRONIZA√á√ÉO</h1>
    
    <div class="box">
        <h2>üéÆ A√ß√µes de Teste</h2>
        <button class="btn-test" onclick="addTestRecord()">‚ûï Adicionar Registro de Teste</button>
        <button class="btn-clear" onclick="clearAll()">üóëÔ∏è Limpar Tudo</button>
        <button class="btn-reload" onclick="location.reload()">üîÑ Recarregar P√°gina</button>
    </div>
    
    <div class="box" id="statusBox">
        <h2>üìä STATUS DO LOCALSTORAGE</h2>
        <div id="statusContent">Carregando...</div>
    </div>
    
    <div class="box">
        <h2>üìù DADOS SALVOS (JSON RAW)</h2>
        <pre id="rawData">Carregando...</pre>
    </div>
    
    <div class="box">
        <h2>üìã LISTA DE REGISTROS</h2>
        <div id="recordsList">Carregando...</div>
    </div>
    
    <div class="box warning">
        <h2>üí° INSTRU√á√ïES</h2>
        <ol>
            <li>Abra esta p√°gina: <code>https://jeanlucan34-coder.github.io/estacionamento-hospital/teste.html</code></li>
            <li>Clique em "‚ûï Adicionar Registro de Teste"</li>
            <li>Veja se aparece na lista abaixo</li>
            <li>Abra o formul√°rio em OUTRA ABA: <code>https://jeanlucan34-coder.github.io/estacionamento-hospital/</code></li>
            <li>Preencha o formul√°rio</li>
            <li>Volte aqui e clique em "üîÑ Recarregar P√°gina"</li>
            <li>Veja se o novo registro apareceu</li>
        </ol>
    </div>

    <script>
        function loadStatus() {
            try {
                // Pegar dados do localStorage
                const data = localStorage.getItem('parkingData');
                
                const statusBox = document.getElementById('statusBox');
                const statusContent = document.getElementById('statusContent');
                const rawData = document.getElementById('rawData');
                const recordsList = document.getElementById('recordsList');
                
                if (!data) {
                    statusBox.className = 'box error';
                    statusContent.innerHTML = `
                        <strong>‚ùå NENHUM DADO ENCONTRADO</strong><br><br>
                        O localStorage est√° vazio.<br>
                        Isso significa que nenhum registro foi feito ainda.
                    `;
                    rawData.textContent = 'null';
                    recordsList.innerHTML = '<p style="color: #999;">Nenhum registro</p>';
                    return;
                }
                
                // Tentar fazer parse
                const parkingData = JSON.parse(data);
                const history = parkingData.history || [];
                
                // Status
                statusBox.className = history.length > 0 ? 'box success' : 'box warning';
                statusContent.innerHTML = `
                    <strong>‚úÖ DADOS ENCONTRADOS!</strong><br><br>
                    üìä <strong>Total de registros:</strong> ${history.length}<br>
                    üè• <strong>Hospital Vila da Serra:</strong> ${history.filter(h => h.location === 'hvs').length}<br>
                    üè• <strong>ONCOBIO:</strong> ${history.filter(h => h.location === 'oncobio').length}<br>
                    üíæ <strong>Tamanho dos dados:</strong> ${data.length} caracteres<br>
                    üïê <strong>Verificado em:</strong> ${new Date().toLocaleTimeString('pt-BR')}
                `;
                
                // JSON Raw
                rawData.textContent = JSON.stringify(parkingData, null, 2);
                
                // Lista de registros
                if (history.length === 0) {
                    recordsList.innerHTML = '<p style="color: #999;">Nenhum registro no hist√≥rico</p>';
                } else {
                    recordsList.innerHTML = history.map((record, index) => `
                        <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #28a745;">
                            <strong>#${index + 1}</strong><br>
                            <strong>CRM:</strong> ${record.crm || 'N/A'}<br>
                            <strong>Nome:</strong> ${record.name || 'N/A'}<br>
                            <strong>Especialidade:</strong> ${record.specialty || 'N/A'}<br>
                            <strong>Local:</strong> ${record.location === 'hvs' ? 'Hospital Vila da Serra' : 'ONCOBIO'}<br>
                            <strong>Data:</strong> ${record.exitTime ? new Date(record.exitTime).toLocaleString('pt-BR') : 'N/A'}
                        </div>
                    `).join('');
                }
                
            } catch (error) {
                document.getElementById('statusBox').className = 'box error';
                document.getElementById('statusContent').innerHTML = `
                    <strong>‚ùå ERRO AO CARREGAR</strong><br><br>
                    ${error.message}
                `;
                document.getElementById('rawData').textContent = 'Erro: ' + error.message;
                document.getElementById('recordsList').innerHTML = '<p style="color: red;">Erro ao carregar registros</p>';
            }
        }
        
        function addTestRecord() {
            try {
                // Buscar dados existentes
                let parkingData = JSON.parse(localStorage.getItem('parkingData') || '{"vehicles":{"hvs":[],"oncobio":[]},"history":[]}');
                
                // Criar registro de teste
                const testRecord = {
                    id: Date.now(),
                    location: 'hvs',
                    crm: 'TESTE-' + Date.now(),
                    name: 'Dr. Teste ' + new Date().toLocaleTimeString('pt-BR'),
                    specialty: 'Teste',
                    phone: '(31) 99999-9999',
                    exitTime: new Date().toISOString(),
                    entryTime: new Date().toISOString(),
                    duration: 0
                };
                
                // Adicionar ao hist√≥rico
                parkingData.history.push(testRecord);
                
                // Salvar
                localStorage.setItem('parkingData', JSON.stringify(parkingData));
                
                alert('‚úÖ Registro de teste adicionado!\n\nTotal de registros: ' + parkingData.history.length);
                
                // Recarregar
                loadStatus();
                
            } catch (error) {
                alert('‚ùå Erro ao adicionar registro: ' + error.message);
            }
        }
        
        function clearAll() {
            if (confirm('‚ö†Ô∏è Tem certeza que deseja limpar TODOS os dados?\n\nIsso vai apagar todo o hist√≥rico!')) {
                localStorage.clear();
                alert('üóëÔ∏è Todos os dados foram apagados!');
                loadStatus();
            }
        }
        
        // Carregar ao iniciar
        loadStatus();
        
        // Atualizar a cada 3 segundos
        setInterval(loadStatus, 3000);
    </script>
</body>
</html>